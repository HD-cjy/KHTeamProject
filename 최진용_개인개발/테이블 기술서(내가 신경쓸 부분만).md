## ERD상 구조 
![[Pasted image 20250531154135.png|340]]
### 테이블명: MESSAGE

| 컬럼명      | Data Type          | Nullable | Key | Description |
| -------- | ------------------ | -------- | --- | ----------- |
| ROOMNO   | NUMBER(11,0)       | NO       | PK  | 채팅방번호       |
| NO       | NUMBER(11,0)       | NO       | PK  | 메시지번호       |
| MESSAGE  | CLOB               | NO       |     | 메시지내용       |
| IMAGEURL | VARCHAR2(255 BYTE) | NO       |     | 이미지URL      |
| USERID   | VARCHAR2(255 BYTE) | NO       | FK  | 보낸사람아이디     |
| SENDTIME | DATE               | NO       |     | 보낸 시간       |

### 테이블명:CHAT_ROOM

| 컬럼이름      | Data Type          | Nullable | Key    | Description                           |
| --------- | ------------------ | -------- | ------ | ------------------------------------- |
| ROOMNO    | NUMBER(11,0)       | NO       | PK, FK | 채팅방번호                                 |
| USERID    | VARCHAR2(255 BYTE) | NO       | PK, FK | 유저 ID (ABC123@TEST123)                |
| LASTVISIT | VARCHAR2(20 BYTE)  | NO       |        | 마지막 방문 EX) ABC123(날짜시간)@TEST123(날짜시간) |
| CHATTYPE  | VARCHAR2(20 BYTE)  | NO       |        | 채팅타입 (이미지 채팅인지 일반 채팅인지)               |


SQL문 추가 
```sql
CREATE SEQUENCE CHAT_MESSAGE_SEQ
    MINVALUE 0
    MAXVALUE 9999999999999999999999999999
    INCREMENT BY 1
    START WITH 1
    NOCYCLE
    NOORDER
    NOCACHE;

```


테이블 재정리 
```sql
-- 모든 테이블의 의존성 역순으로 DROP (안전한 재구성을 위함)
-- 요청에 따라 CHAT_ROOM과 MESSAGE 먼저 DROP
DROP TABLE MESSAGE CASCADE CONSTRAINTS;
DROP TABLE CHAT_ROOM CASCADE CONSTRAINTS;

-- 나머지 테이블들 DROP
DROP TABLE SUBSCRIPTION CASCADE CONSTRAINTS;
DROP TABLE FAVORITE CASCADE CONSTRAINTS;
DROP TABLE USERQNA_INFO CASCADE CONSTRAINTS;
DROP TABLE ANSWER_INFO CASCADE CONSTRAINTS;
DROP TABLE SALL_REVIEW CASCADE CONSTRAINTS;
DROP TABLE PRODUCT CASCADE CONSTRAINTS;
DROP TABLE USER_INFO CASCADE CONSTRAINTS;

```
### USER 더미데이터 
```sql
-- 1. USER_INFO 더미 데이터 삽입
-- USERNO는 시퀀스 목록에 USER_INFO에 대한 직접적인 시퀀스가 없으므로 일단 직접 할당합니다.
-- 실제 애플리케이션에서는 USERNO를 위한 시퀀스를 별도로 생성하거나,
-- DDL에서 IDENTITY 속성을 사용하여 자동 생성되도록 설정하는 것이 일반적입니다.
INSERT INTO DAMGEUN.USER_INFO (USERNO, USERID, PASSWORD, USERNAME, EMAIL, STATUS, USERRANK)
VALUES (1, 'user1', 'password1', '홍길동', 'user1@example.com', 'Y', 100);

INSERT INTO DAMGEUN.USER_INFO (USERNO, USERID, PASSWORD, USERNAME, EMAIL, STATUS, USERRANK)
VALUES (2, 'user2', 'password2', '김철수', 'user2@example.com', 'Y', 95);

INSERT INTO DAMGEUN.USER_INFO (USERNO, USERID, PASSWORD, USERNAME, EMAIL, STATUS, USERRANK)
VALUES (3, 'user3', 'password3', '이영희', 'user3@example.com', 'Y', 90);

INSERT INTO DAMGEUN.USER_INFO (USERNO, USERID, PASSWORD, USERNAME, EMAIL, STATUS, USERRANK)
VALUES (4, 'user4', 'password4', '박민수', 'user4@example.com', 'Y', 92);

INSERT INTO DAMGEUN.USER_INFO (USERNO, USERID, PASSWORD, USERNAME, EMAIL, STATUS, USERRANK)
VALUES (5, 'admin', 'admin123', '관리자', 'admin@example.com', 'Y', 0);

COMMIT;
```



#  씨뻘 좃댓다 . sql 수정
```sql

  CREATE TABLE "DAMGEUN"."CHAT_ROOM" 
   (	"ROOMNO" NUMBER(11,0) NOT NULL ENABLE, 
	"USERID" VARCHAR2(255 BYTE) NOT NULL ENABLE, 
	"LASTVISIT" VARCHAR2(20 BYTE) NOT NULL ENABLE, 
	"CHATTYPE" VARCHAR2(20 BYTE) NOT NULL ENABLE, 
	 CONSTRAINT "CHAT_ROOM_PK" PRIMARY KEY ("ROOMNO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;

   COMMENT ON COLUMN "DAMGEUN"."CHAT_ROOM"."ROOMNO" IS '채팅방번호';
   COMMENT ON COLUMN "DAMGEUN"."CHAT_ROOM"."USERID" IS '유저 ID(ABC123@TEST123)';
   COMMENT ON COLUMN "DAMGEUN"."CHAT_ROOM"."LASTVISIT" IS '마지막방문 EX)ABC123(날짜시간)@TEST123(날짜시간)';
   COMMENT ON COLUMN "DAMGEUN"."CHAT_ROOM"."CHATTYPE" IS '채팅타입(이미지 채팅인지 일반 채팅인지)';


```

mesaage
```sql

  CREATE TABLE "DAMGEUN"."MESSAGE" 
   (	"ROOMNO" NUMBER(11,0) NOT NULL ENABLE, 
	"NO" NUMBER(11,0) NOT NULL ENABLE, 
	"MESSAGE" CLOB NOT NULL ENABLE, 
	"IMAGEURL" VARCHAR2(255 BYTE) NOT NULL ENABLE, 
	"USERID" VARCHAR2(255 BYTE) NOT NULL ENABLE, 
	"SENDTIME" DATE NOT NULL ENABLE, 
	 CONSTRAINT "MESSAGE_PK" PRIMARY KEY ("NO", "ROOMNO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE, 
	 CONSTRAINT "ROOM_NO_FK" FOREIGN KEY ("ROOMNO")
	  REFERENCES "DAMGEUN"."CHAT_ROOM" ("ROOMNO") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" 
 LOB ("MESSAGE") STORE AS BASICFILE (
  TABLESPACE "SYSTEM" ENABLE STORAGE IN ROW CHUNK 8192 RETENTION 
  NOCACHE LOGGING 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;

   COMMENT ON COLUMN "DAMGEUN"."MESSAGE"."ROOMNO" IS '채팅방번호';
   COMMENT ON COLUMN "DAMGEUN"."MESSAGE"."NO" IS '메시지번호';
   COMMENT ON COLUMN "DAMGEUN"."MESSAGE"."MESSAGE" IS '메시지내용';
   COMMENT ON COLUMN "DAMGEUN"."MESSAGE"."IMAGEURL" IS '이미지URL';
   COMMENT ON COLUMN "DAMGEUN"."MESSAGE"."USERID" IS '보낸사람아이디';
   COMMENT ON COLUMN "DAMGEUN"."MESSAGE"."SENDTIME" IS '보낸 시간';


```

```sql
 
-- 1. 외래키가 있는 하위 테이블부터 삭제
DROP TABLE MESSAGE CASCADE CONSTRAINTS;
DROP TABLE CHAT_PARTICIPANT CASCADE CONSTRAINTS;
DROP TABLE CHAT_ROOM CASCADE CONSTRAINTS;
---드롭구문 
commit;

```